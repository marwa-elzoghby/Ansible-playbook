---
- name: Configure AWS Linux instances
  hosts: aws_linux
  become: yes
  tasks:

    - name: Update all system packages
      yum:
        name: '*'
        state: latest
      tags: update

    - name: Create a new user with sudo access
      user:
        name: devopsuser
        state: present
        groups: wheel
        append: yes
      tags: user

    - name: Install and start Nginx, and deploy a sample web page
      block:
        - name: Install nginx
          yum:
            name: nginx
            state: present

        - name: Start and enable nginx
          service:
            name: nginx
            state: started
            enabled: yes

        - name: Deploy sample index.html
          copy:
            dest: /usr/share/nginx/html/index.html
            content: "<h1>Welcome from Ansible on {{ inventory_hostname }}</h1>"
      tags: nginx
